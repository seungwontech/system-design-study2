제시해주신 구체적인 요구사항과 기술적 상세 설계 내용을 바탕으로, **'가상 면접 사례로 배우는 대규모 시스템 설계 기초 2'의 3장: 구글 맵 설계** 편을 블로그 포스팅 형식으로 상세히 정리해 드립니다.

---

## [대규모 시스템 설계] 10억 DAU를 위한 구글 맵 설계하기

구글 맵은 단순히 지도를 보여주는 서비스를 넘어, 전 세계의 도로 데이터를 그래프화하고 실시간 교통 상황을 초 단위로 계산해야 하는 초거대 시스템입니다.  
이번 글에서는 10억 명의 사용자를 감당하기 위한 구글 맵의 핵심 설계 요소를 단계별로 살펴보겠습니다.

---

## 1단계: 설계 범위 및 요구사항 확정

* **DAU (Daily Active Users):** 10억 명
* **핵심 기능:**

1. **위치 서비스:** 사용자의 실시간 위치 갱신
2. **경로 안내:** 예상 도착 시간(ETA)을 포함한 경로 탐색
3. **지도 표시:** 부드러운 지도 렌더링 및 갱신


* **비기능적 요구사항:**
* **정확도:** 오차 없는 경로 안내
* **효율성:** 모바일 단말의 데이터 및 배터리 사용량 최소화
* **가용성:** 대규모 트래픽에도 중단 없는 서비스

---

## 2단계: 지도의 기초와 데이터 처리 (Map 101)

### 지오해싱 (Geohashing)과 타일 시스템

지도를 효율적으로 관리하기 위해 세상을 격자로 나눕니다.

* **지도 타일 (PNG/Vector):** 사용자가 보는 화면을 작은 사각형(타일)으로 쪼개어 CDN을 통해 서빙합니다. 줌 레벨이 올라갈수록 타일 수는 4배씩 증가하며 더 상세한 정보를 담습니다.
* **지오해싱:** 2차원 좌표를 문자열로 변환하여 격자를 재귀적으로 분할합니다. 본 설계에서는 맵 타일 관리의 핵심으로 사용됩니다.

### 경로 안내를 위한 도로 데이터 처리

경로 탐색 알고리즘(Dijkstra, A*)은 도로를 **그래프(Graph)** 구조로 인식합니다.

* **Node (노드):** 교차로
* **Edge (간선):** 도로
* **경로 안내 타일 (Routing Tile):** 도로망 데이터를 지오해시 기반의 격자로 나눈 바이너리 파일입니다. 필요한 지역의 도로망만 메모리에 올릴 수 있어 성능을 극대화합니다.

### 계층적 경로 안내 타일

효율적인 탐색을 위해 도로의 중요도에 따라 세 단계로 데이터를 관리합니다.

1. **상(High):** 지방도 위주의 아주 상세한 데이터 (좁은 영역)
2. **중(Medium):** 간선 도로 위주의 데이터
3. **하(Low):** 도시/주를 잇는 고속도로 데이터 (넓은 영역)

---

## 3단계: 개략적 설계안

시스템은 크게 세 갈래로 나뉩니다.

### 1. 위치 서비스 (Location Service)

사용자의 위치 이력을 기록합니다.

* **전송 전략:** 매번 보내기보다 클라이언트에 버퍼링 후 일괄 전송하여 배터리 절약.
* **저장소:** 초당 수백만 건의 쓰기를 견뎌야 하므로 **카산드라(Cassandra)** 같은 NoSQL 활용.

### 2. 지도 표시 (Map Display)

이미지는 정적 데이터이므로 **CDN**을 적극 활용합니다.

1. 클라이언트가 위치/줌 레벨을 전달하면 **지도 타일 서비스**가 필요한 9개의 타일 URL을 계산합니다.
2. 클라이언트는 해당 URL로 **CDN**에서 이미지를 가져옵니다.

### 3. 경로 안내 서비스 (Navigation)

A에서 B까지의 최적 경로를 계산합니다.

* **지오코딩 서비스:** 주소 ↔ 위도/경도 변환 (Redis 캐시 활용)
* **최단 경로 서비스:** 교통 상황을 제외한 정적 도로망(A* 알고리즘) 기반 k개 경로 추출.
* **ETA 서비스:** 실시간 교통 정보 및 머신러닝 모델을 활용해 소요 시간 추정.
* **순위 결정(Ranker):** 사용자 옵션(유료도로 제외 등)에 따라 최종 경로 결정.

---

## 4단계: 상세 설계 및 최적화 포인트

### 최적화: 벡터 타일 (Vector Tiles)

과거에는 이미지를 직접 보냈지만, 이제는 **벡터(Vector)** 방식을 사용합니다.

* **장점:** 압축률이 월등해 대역폭을 아끼고, 확대해도 깨짐 없이 매끄러운 경험을 제공합니다.

### 실시간 교통 정보 갱신

수집된 사용자 위치 데이터 스트림은 **카프카(Kafka)** 를 거쳐 실시간 교통 정보 DB와 경로 안내 타일을 업데이트합니다.

### 적응형 경로 변경 (Rerouting)

교통 사고 등으로 상황이 변했을 때 영향을 받는 사용자를 효율적으로 찾는 것이 관건입니다.

* **비효율적 방식:** 모든 사용자 경로 전수 조사 ($O(n \times m)$)
* **효율적 방식:** 사용자의 경로 타일을 계층 구조(Recursive)로 관리하여, 사고 발생 타일을 상위 타일 수준에서 빠르게 필터링 ($O(n)$)

### 전송 프로토콜: 웹소켓(WebSocket)

경로 안내 중 서버에서 클라이언트로 실시간 정보를 보내기 위해 **웹소켓(WebSocket)** 을 사용합니다.

이유: 모바일 푸시는 메시지 크기가 제한적이고, 롱 폴링은 오버헤드가 큽니다.  
웹소켓은 실시간 양방향 통신이 가능하여 경로 변경 알림이나 목적지 근접 정보를 지연 없이 전달하기에 가장 적합합니다.

---

## 5단계: 마무리 및 결론

대규모 시스템 설계에서 중요한 것은 **데이터의 성격에 맞는 저장소와 전송 전략**을 선택하는 것입니다.

* **지도 타일**은 정적이므로 **S3와 CDN**으로 비용 절감.
* **사용자 위치**는 가용성이 중요한 쓰기 집약 데이터이므로 **카산드라** 선택.
* **도로망 데이터**는 그래프 구조로 파티셔닝하여 **바이너리 파일**로 관리.

