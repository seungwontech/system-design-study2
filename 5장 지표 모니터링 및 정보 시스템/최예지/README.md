# (5) 지표 모니터링 및 경보 시스템

## 1단계: 문제 이해 및 설계 범위 확정

### 개략적 요구사항 및 가정

- 대규모 인프라를 모니터링 해야함
    - DAU: 1억명
    - 서버 풀 1,000개, 풀 당 서버수 100개.
        - 서버당 100개의 운영지표를 수집한다 가정 → 모니터링 필요 지표 수 ~= 천만 개
    - 데이터 보관기간: 1년
        - ~7일: 데이터 원본 보관
        - ~30일: 1분 단위 데이터 보관
        - ~1년: 1시간 단위 데이터 보관
- 모니터링 지표 예시 (⏬ 저~고)
    - CPU 사용률
    - 메모리 사용량
    - 요청 수
    - 메시지 큐 내의 메시지 수

### 비기능 요구사항

- 규모 확장성
- 낮은 응답 지연: 대시보드와 경보를 신속하게 ㅈ처리
- 안정성
- 유연성: 미래의 신기술을 쉽게 통합할 수 있게 유연한 파이프라인 구축 필요

### 비고려 요구사항

- 로그 모니터링
    - ELK(Elasticsearch, Logstash, Kibana) 등이 로그 모니터링 용도로 널리 사용되는 시스템임
- 분산 시스템 추적
    - 서비스에 대한 요청이 분산 시스템 내부를 어떻게 흘러 다니는지 추적할 수 있도록 하는 시스템.
    - 요청이 한 서비스에서 다른 서비스로 이동할 때마다 데이터를 수집.

## 2단계: 개략적 설계안 제시 및 동의 구하기

### 기본적 사항

- 데이터 수집: 여러 출처로 부터 지표 데이터를 수집
- 데이터 전송: 모니터링 시스템으로 지표데이터를 전송
- 데이터 저장소: 전송 되어 온 데이터를 정리 및 저장
- 경보: 데이터 분석, 이상 징후 감지, 경보 발생
    - 다양한 통신 채널로 발송할 수 있어야 함
- 시각화: 데이터를 차트, 그래프 등으로 시각화

### 데이터 모델

- 지표 데이터는 통상 시계열 데이터 형태로 기록
    - 값 집합에 타임스탬프가 붙음
    - 시계열 각각에 고유한 이름이 붙음
    - 레이블을 붙이기도 함
- 사례 1
    
    ![image.png](https://img.notionusercontent.com/s3/prod-files-secure%2F594418fe-2b8a-40ce-8d83-fb1b120f4b8f%2Fff7db227-e82b-457c-91f0-dc40cf94867a%2Fimage.png/size/w=930?exp=1770907550&sig=Oz9EoF_EyolkYztzCKDmMTcuIBYyuCjXwaFpMwtCZuo&id=304be4ca-d9d2-80ed-bd63-ce117cf1b458&table=block)
    
    | metric_name | cpu.load |
    | --- | --- |
    | labels | host:i631,env:prod |
    | timestamp | 1613707265 |
    | value | 0.29 |
- 사례 2
    - 지난 10분간 us-west 지역에 위치한 모든 웹 서버의 CPU 부하 평균값은?
        - 지표이름: CPU.load  레이블지역이름: us-west 로 검색 후 각 행의 마지막에 기록 된 CPU 부하 수치의 평균
    
    ```
    CPU.load host=webserver01,region=us-west 1613707265 **50**
    CPU.load host=webserver01,region=us-west 1613707265 **62**
    CPU.load host=webserver02,region=us-west 1613707265 **43**
    CPU.load host=webserver02,region=us-west 1613707265 **53**
    ...
    CPU.load host=webserver01,region=us-west 1613707265 **76**
    CPU.load host=webserver01,region=us-west 1613707265 **83**
    ```
    
    - 각 행의 데이터 형식은 행 프로토콜을 따르고 있음.
        - 시장의 많은 모니터링 소프트웨어가 공통 형식을 준수함 (프로메테우스, OpenTSDB 등…)
    - 모든 시계열 데이터는 다음 정보로 구성
        
        
        | 이름 | 자료형 |
        | --- | --- |
        | 지표 이름 | 문자열 |
        | 태그/레이블 집함 | <키:값> 쌍의 리스트(List) |
        | 지표 값 및 그 타임스탬프의 배열 | <값, 타임스탬프> 쌍의 배열(Array) |
    - 데이터 접근 패턴
        
        ![image.png](https://possible-telephone-196.notion.site/image/attachment%3A7b38f7f0-6a44-4108-a7e6-af19bdb50510%3Aimage.png?table=block&id=304be4ca-d9d2-8087-8a15-e94c4d4720df&spaceId=594418fe-2b8a-40ce-8d83-fb1b120f4b8f&width=880&userId=&cache=v2)
        
        - ❓ y축에 붙은 레이블: 하나의 시계열 데이터 (이름과 레이블을 통해 유일하게 식별되는 데이터)
        - x축에 붙은 레이블: 시간
        - 쓰기 부하: 막대함 (매일 천만 개)
        - 읽기 부하: 일시적으로 치솟았다 사라지는 편 (spiky)
            - 시각화, 경보 서비스에서 일시적으로 읽기 연산을 발생

### 데이터 저장소 시스템

- RDBMS → 부적합한 이유
    - 설계안의 부하 규모에 맞추려면 전문가 수준의 튜닝 필요
    - 시계열의데이터를 대상으로 통상적으로 지원하는 연산에 최적화x
    - 태그/레이블에 대한 질의를 지원하려면 태그마다 인덱스 필요
    - 막대한 쓰기연산에 비효율적
- NoSQL
    - 확장이 용이한 스키마를 설계 → NoSQL의 내부 구조에 해박한 지식이 필요 → 범용 NoSQL 베이스는 썩 매력x
- 시계열 데이터에 최적화된 저장소 시스템
    - 같은 양의 시계열 데이터를 더 적은 서버에 보관 가능
    - 시계열 데이터 분석에 적합
    - SQL보다 사용하기 쉬운 질의 인터페이스 보유
    - 데이터 보관 기간 설정, 데이터 집계 기능 옵션 제공
    - OpenTSDB
        - 분산 시계열 데이터베이스
        - Hadoop, HBase에 기반 → Hadoop/HBase 클러스터를 구성 및 운영 필요 (복잡)
    - 트위터: MetricsDB, 아마존:타임스트림(Timestream)출시 …
    - 시장에서 가장 인기 있는 시계열 데이터베이스: InfluxDB, 프로메테우스
        - 다량의 시계열 데이터를 저장
        - 빠른 실시간 분석 지원
        - 메모리 캐시, 디스크 저장소를 함께 사용
        - 영속성 요건, 성능 요구사항 만족
        - ex) 8CPU코어, 32GB램을 갖춘 InfluxDB서버 한대로 초당 250,000회의 쓰기 연산 처리 가능
            
            
            | vCPU 또는 CPU | RAM | IOPS | 초당 쓰기 연산 횟수 | 초당 질의 횟수 | 고유한 시계열 개수 |
            | --- | --- | --- | --- | --- | --- |
            | 2–4 코어 | 2–4 GB | 500 | < 5,000 | < 5 | < 100,000 |
            | 4–6 코어 | 8–32 GB | 500–1000 | < 250,000 | < 25 | < 1,000,000 |
            | 8+ 코어 | 32+ GB | 1000+ | > 250,000 | > 25 | > 1,000,000 |
    - 좋은 시계열 데이터베이스의 조건
        - 막대한 양의 레이블(or태그) 기준으로 집계, 분석 기능 제공

### 개략적 설계안

![image.png](https://possible-telephone-196.notion.site/image/attachment%3A50026a48-bd79-488b-84ae-8f4f9b861f18%3Aimage.png?table=block&id=304be4ca-d9d2-80e3-b899-f5e5f852e407&spaceId=594418fe-2b8a-40ce-8d83-fb1b120f4b8f&width=990&userId=&cache=v2)

- 지표 출처: 지표 데이터가 만들어지는 곳.
    - ex. 애플리케이션 서버, SQL 데이터베이스, 메시지 큐 …
- 지표 수집기: 지표데이터를 수집 → 시계열 데이터에 기록
- 시계열 데이터베이스: 지표 데이터를 시계열 데이터 형태로 보관하는 장소. 다량의 데이터를 분석, 요약하는데 적합하게 설계된 질의 인터페이스 제공
- 질의 서비스: 시계열 데이터베이스에 보관된 데이터를 질의, 가져오는 과정을 돕는 서비스
    - 좋은 시계열 데이터베이스를 골랐다면 많은 일을 하지 않음
- 경보 시스템: 다양한 경보 수신 대상으로 경보 알림을 전송하는 시스템
- 시각화 시스템: 지표 → 다양한 형태의 그래프/차트로 시각화 하는 기능 제공 시스템

## 3단계: 상세 설계

### 지표 수집

- 카운터(counter)나 CPU 사용량 같은 지표는 일부 데이터가 소실되어도 OK → 지표 전송 클라이언트는 ACK=0이어도 괜찮음
- 풀 vs 푸시 모델
    - 풀 모델
        - 프로메테우스가 채택
        
        ![image.png](https://possible-telephone-196.notion.site/image/attachment%3A177c6ec1-6aa4-42a6-9d95-264a63852fcd%3Aimage.png?table=block&id=304be4ca-d9d2-801a-920a-ee6190a88ee8&spaceId=594418fe-2b8a-40ce-8d83-fb1b120f4b8f&width=880&userId=&cache=v2)
        
        - 지표 수집기가 사용 중인 애플리케이션에서 주기적으로 지표 데이터를 수집함
        - 지표수집기가 데이터를 가져올 서비스 목록을 아는 방법:
            - 각 서비스는 자신의 가용성 관련 정보를 서비스 탐색 서비스(SDS)에 기록, SDS는 서비스 엔드포인트 목록에 변화가 생길때 마다 지표수집기에 통보
            
            ![image.png](https://possible-telephone-196.notion.site/image/attachment%3Aceed2eaa-3aaf-4df5-8e3b-e5aa2d810431%3Aimage.png?table=block&id=304be4ca-d9d2-802a-9dd8-f9b39667d16f&spaceId=594418fe-2b8a-40ce-8d83-fb1b120f4b8f&width=820&userId=&cache=v2)
            
            1. 지표 수집기: SDS에서 서비스 엔드포인트 설정 메타데이터(지표 수집 주기, IP 주소, 타임아웃, 재시도 인자 등) 목록을 가져옴. 
            2. 지표 수집기: 사전에 합의 된 HTTP 엔드포인트에서 (ex. /metrics) 지표 데이터를 수집. 
                - 이런 엔드포인트를 수집기에 노출하기 위해서 통상 서비스에 특정 클라이언트 라이브러리를 추가
            3. 지표 수집기: 서비스 엔드포인트 목록의 변화를 통지 받기 위한 변경 이벤트 알림 콜백을 SDS에 등록 가능. (혹은 그냥 주기적 요청도 가능)
        - 수천 대 서버가 만들어내는 지표 데이터를 수집하려면 지표 수집기 서버 풀이 필요
            - → 여러 서버가 같은 출처에서 중복된 데이터를 가져올 가능성 존재
            - → 해결법: 안정 해시 링 사용
            
            ![image.png](https://possible-telephone-196.notion.site/image/attachment%3A56c2c648-782c-4bd7-939f-2ac9e4900794%3Aimage.png?table=block&id=304be4ca-d9d2-80c6-9f52-d71979606ecc&spaceId=594418fe-2b8a-40ce-8d83-fb1b120f4b8f&width=820&userId=&cache=v2)
            
    - 푸시모델
        - 아마존 클라우드와치, 그래파이트가 채택
        - 지표 출처에 해당하는 서버가 직접 지표 수집기에 데이터를 전송
        - 모니터링 대상 서버에 통상 **수집 에이전트**라 불리는 소프트웨어를 설치
        - 수집 에이전트
            
            ![image.png](https://possible-telephone-196.notion.site/image/attachment%3A9d995ce1-27c5-4848-b73f-9d392f2b946a%3Aimage.png?table=block&id=304be4ca-d9d2-8050-9932-ee4e1f5aa317&spaceId=594418fe-2b8a-40ce-8d83-fb1b120f4b8f&width=820&userId=&cache=v2)
            
            - 서비스가 생산하는 지표 데이터를 받아 모은 다음 주기적으로 수집기에 전달
        - 데이터 집계: 수집기에 보내는 데이터 양을 줄이는데 효과적
        - 수집기가 일시적으로 전송되는 데이터 처리x 오류 반환 → 에이전트 내부의 소규모 버퍼에 일시적으로 데이터를 보관, 이후 재전송 가능
            - 다만, 에이전트가 존재하는 서버 클러스터가 자동 규모 확장이 가능하면 서버의 동적 추가/삭제 시 데이터 소실 가능
        - 지표 수집기가 몰려드는 데이터를 제대로 처리하지 못하는 걸 방지하기 위해 자체적 자동 규모확장, 로드밸런서 지원 가능
        
        ![image.png](https://possible-telephone-196.notion.site/image/attachment%3A1c57a135-7309-48d7-888a-1f6d30080007%3Aimage.png?table=block&id=304be4ca-d9d2-80f5-a1f8-ed432dde3474&spaceId=594418fe-2b8a-40ce-8d83-fb1b120f4b8f&width=880&userId=&cache=v2)
        
    - 풀 모델 vs 푸시 모델
        - 각 장단점에 따라 모델 선택하면 됨
        
        | 항목 | 풀 모델 | 푸시 모델 |
        | --- | --- | --- |
        | 손쉬운 디버깅 | 애플리케이션 서버의 `/metrics` 엔드포인트를 주도적으로 조회하므로 필요할 때 언제든 지표 데이터를 볼 수 있고, 랩톱에서도 가능함. **풀 모델이 더 낫다.** |  |
        | 상태 진단 (health check) | 애플리케이션 서버가 풀 요청에 응답하지 않으면 장애로 진단 가능. **풀 모델 쪽이 쉽다.** | 지표 수집기가 지표를 받지 못하면 네트워크 장애인지 서버 장애인지 원인 파악이 어려움. |
        | 생존 기간이 짧은 프로세스 |  | 생명 주기가 짧은 일괄 작업 프로세스의 경우 수집기가 지표를 끌어가기 전에 종료될 수 있음. 그런 점에서는 **푸시 모델이 낫다.** 푸시 게이트웨이 도입으로 문제를 완화할 수 있음. |
        | 방화벽 등 복잡한 네트워크 구성 | 수집기 서버가 지표 데이터를 끌어가려면 모든 `/metrics` 엔드포인트에 접근 가능하도록 설계되어야 함. 데이터센터 여러 개 사용 시 문제 될 수 있음. 네트워크 인프라설계를 세심히 해야 함.  | 지표 수집기가 로드밸런서 및 자동 규모 확장 클러스터 형태로 구성됐다면, 어디서 오는 지표라도 수집 가능함. **푸시 모델이 낫다.** |
        | 성능 | 일반적으로 TCP 사용. | 보통 UDP 사용. = 전송 지연이 더 낮음. 이에대한 반론은 TCP 연결을 맺는 데 드는 오버헤드가 지표 데이터를 전송하는 것에 비해 낮음. |
        | 데이터 신빙성 | 지표 데이터를 가져올 애플리케이션 서버 목록이 이미 정의된 상태이므로, 해당 서버에서 수집한 데이터는 믿을 수 있음. | 아무나 지표 수집기에 데이터를 보낼 수 있는 문제가 있음. 허용할 서버 목록을 수집기 측에 유지하거나 인증을 강제해 해결 가능. |

### 지표 전송 파이프라인의 규모 확장

- 풀 vs 푸시 모델에 상관 없이 지표 수집기는 서버 클러스터 형태로 대규모 데이터를 받아 처리해야함. 자동 규모 확장이 가능해야 함.
- 시계열 데이터베이스에 장애가 생길 시 데이터 손실이 발생할 가능성 존재 ⇒ 큐를 두어 해결
    
    ![image.png](https://possible-telephone-196.notion.site/image/attachment%3A8ae7ddcc-022a-4a77-89cb-7e759cfba100%3Aimage.png?table=block&id=304be4ca-d9d2-80a5-aac8-e3d58fdcaca8&spaceId=594418fe-2b8a-40ce-8d83-fb1b120f4b8f&width=930&userId=&cache=v2)
    
    - 지표수집기 > 큐 시스템(ex 카프카) > 소비자(아파치 스톰, 플링크, 스파크 등) :시계열 데이터 베이스에 저장
    - 장점
        - 카프카는 고도로 안정적이고 규모 확장성이 뛰어난 분산 메시지 플랫폼임
        - 데이터 수집 컴포넌트 ↔ 처리 컴포넌트 간 결합도를 낮춤
        - 데이터베이스에 장애가 생겨도 데이터는 소실되지 않음. (카프카에 보관하면 됨)
- 카프카를 통한 규모 확장 (카프카 내장 파티션 매커니즘 사용)
    
    ![image.png](https://possible-telephone-196.notion.site/image/attachment%3A56a8d638-1fef-4ff0-98f2-eb72b5e236ae%3Aimage.png?table=block&id=304be4ca-d9d2-8069-a7c7-dc2ca5112fa1&spaceId=594418fe-2b8a-40ce-8d83-fb1b120f4b8f&width=930&userId=&cache=v2)
    
    - 대역폭 요구사항에 따라 파티션 수를 설정
    - 지표 이름에 따라 어떤 지표를 어느 파티션에 배치할지 결정. → 소비자가 지표 이름에 따라 데이터를 집계
    - 태그/레이블에 따라 지표 데이터를 더욱 세분화한 파티션으로 나눔
    - 중요 지표가 먼저 처리될 수 있도록 지표를 분류, 우선순쉬를 지정

### 데이터 집계 지점

- 수집 에이전트가 집계하는 방안 (클라이언트 측 집계 방안)
    - 복잡한 집계 로직은 지원x (어떤 카운터 값을 분 단위로 집계하는 수준)
- 데이터 수집 파이프라인에서 집계하는 방안 (저장소 기록 전 집계하는 방안)
    - 스트림 프로세싱 엔진(ex 플링크) 필요
    - 데이터 베이스는 계산 결과만 기록 > 기록 양 감소 효과
    - 늦게 도착하는 지표 데이터의 처리가 어려움 & 원본 데이터를 보관하지 않음 ⇒ 정밀도, 유연성 측명 손해
- 질의 시에 집계하는 방안 (저장소 기록 후에 집계하는 방안)
    - 데이터를 날 것 그대로 보관, 질의 시 필요한 시간 구간에 맞게 집계
    - 데이터 손실 문제x
    - 질의 처리 순간에 전체 데이터세트를 대상으로 집계 결과를 계산 → 느린 속도

### 질의 서비스

- 질의 서버 클러스터 형태로 구현
- 시각화 or 경보 시스템에서 접수된 요청을 시계열 데이터베이스를 통해 처리
- 질의 처리 전담 서비스를 둘 때의 장점: 클라이언트(시각화, 경보 시스템) ↔ 시계열 데이터베이스 간 결합도 감소
- 캐시 계층 도입 시 시계열 데이터 베이스에 대한 질의 부하를 낮추고, 질의 서비스의 성능을 높일 수 있음.
- 질의 서비스를 두면 곤란한 경우
    - 대부분의 상용 시각화 및 경보 시스템은 시장에서 널리 사용되는 시계열 데이터베이스와의 연동을 처리하는 강력한 플러그인을 이미 갖춘 경우가 많음 → 별도 캐시를 도입할 필요가 없을 수도 있음
- 시계열 데이터 베이스 질의어
    - 프로메테우스, InfluxDB 등의 지표 모니터링 시스템들은 SQL이 아닌 독자 질의어를 제공
    - SQL 사용 시
        
        ```sql
        select id ,
               temp ,
               avg(temp) over ( partition by group_nr order by time_read )
                   as rolling_avg
        from (
            select id ,
                   temp ,
                   time_read ,
                   interval_group ,
                   id - row_number() over ( partition by interval_group order by time_read ) as group_nr
            from (
                select id ,
                       time_read ,
                       "epoch"::timestamp + "900 seconds"::interval * (extract(
                           epoch from time_read)::int4 / 900) as interval_group ,
                       temp
                from readings
            ) t1
        ) t2
        order by time_read;
        ```
        
    - Flux(InfluxDB의 질의어)언어 사용
    
    ```sql
    from("db:telegraf")
      |> range(start: -1h)
      |> filter(fn: (r) => r._measurement == "foo")
      |> exponentialMovingAverage(size: 10s)
    ```
    

### 저장소 계층

- 시계열 데이터베이스는 신중하게 선택할 것
    - 페이스북에서 내놓은 연구논문: 운영 데이터 저장소에 대한 질의 85%는 지난 26시간 내에 수집된 데이터를 대상
    - ⇒ 위를 잘 활용하는 시계열 데이터베이스를 고르면 성능측면에서 큰 이득
- 저장 용량 최적화
    - 데이터 인코딩 및 압축
        - 1610087371 ↔ 1610087381 : 10초 차이
        - 타임스탬프: 32비트, 10: 4비트
            - 1610087371, 1610087381, 1610087391, 1610087400, 1610087411
            - (성능 승)1610087371, 10, 10, 9, 11
    - 다운샘플링
        - 데이터의 해상도를 낮춰 저장소 요구량을 줄이는 기법
        - 예시
            - 7일 이내 데이터: 샘플링x
            - 30일 이내 데이터: 1분 해상도
            - 1년 이내 데이터: 1시간 해상도
        - 예시2
            - 10초 해상도 데이터
            - 30초 해상도 데이터
- 냉동 저장소
    - 잘 사용되지 않는 비활성 상태 데이터를 보관하는 장소. 일반 저장소에 비해 비용이 낮음

### 경보 시스템

일반적으로 상용품을 가져다 씀

- 구성 사례
    
    ![image.png](https://possible-telephone-196.notion.site/image/attachment%3Aa4cbce57-1dcc-423d-94df-914299054316%3Aimage.png?table=block&id=304be4ca-d9d2-80a5-8bb3-c1ef3eac2067&spaceId=594418fe-2b8a-40ce-8d83-fb1b120f4b8f&width=930&userId=&cache=v2)
    
    1. 설정 파일을 가져와 캐시 서버에 보관. 경보 규칙은 디스크 파일 상태로 보관, 규칙정의는 YAML이 널리 사용 됨
        
        ```yaml
        - name: instance_down
          rules:
            # Alert for any instance that is unreachableable for >5 minutes.
            - alert: up == 0
              for: 5m
          labels:
            severity: page
        ```
        
    2. 경보 관리자: 경보 설정 내역을 캐시에서 가져옴
    3. 경보 관리자: 설정된 규칙에 근거하여 지정된 시간마다 질의 서비스를 호출. 질의 결과가 설정된 임계값을 위반하면 경보 이벤트를 생성
        
        그 외의 경보 관리자의 작업
        
        - 경보 필터링, 병합, 중복 제거: 짧은 시간 동안 같은 인스턴스에서 발생한 경보는 병합 가능
        - 접근 제어: 사람의 실수로 빚어지는 장애 방지. 시스템 보안 유지를 위해 필요
        - 재시도: 경보 상태를 확인, 알림이 최소 한 번은 전달됨을 보장
    4. 경보 저장소: 키-값 저장소. 모든 경보의 상태(비활성화, 응답 대기, 경보 발령, 문제 해결 등)가 여기보관됨. 알림이 적어도 한 번 이상 전달되도록 보장하는 역할
    5. 경보 관리자: 경보 이벤트를 카프카에 전달
    6. 경보 소비자: 카프카에서 경보 이벤트를 읽음
    7. 경보 소비자: 카프카에서 읽은 경보 이벤트를 처리 → 이메일, 단문 메시지, 페이저듀티, HTTP 서비스 엔드포인트 등의 다양한 채널로 알림 전송

### 시각화 시스템

일반적으로 상용품을 가져다 씀

데이터 계층 위에 만들어짐. 

- 지표 대시보드: 지표를 다양한 시간 범위로 표시
- 경보 대시보드: 다양한 경보의 상태를 표시
- 예시: 그라파나 UI
    
    ![image.png](https://possible-telephone-196.notion.site/image/attachment%3Af49f5597-8f14-45e3-bd18-73e207f126c0%3Aimage.png?table=block&id=304be4ca-d9d2-809e-8cb1-e8169fa967d0&spaceId=594418fe-2b8a-40ce-8d83-fb1b120f4b8f&width=930&userId=&cache=v2)
    

# 4단계: 마무리

### 최종 설계안

![image.png](https://possible-telephone-196.notion.site/image/attachment%3Abd6b53e2-d8c1-4cf4-9939-2d705bdb4f27%3Aimage.png?table=block&id=304be4ca-d9d2-807b-bfe3-ed82e944d4a9&spaceId=594418fe-2b8a-40ce-8d83-fb1b120f4b8f&width=990&userId=&cache=v2)

---

## 추가공부(복습)

### TCP vs UDP

- 한줄 정의
    - **TCP**: 연결을 맺고, 순서·재전송까지 책임지는 **신뢰성 있는 전송** 프로토콜.
    - **UDP**: 연결 없이 던지고 끝내는 **빠르고 단순한 전송** 프로토콜.
- 특징 비교
    
    
    | **항목** | **TCP** | **UDP** |
    | --- | --- | --- |
    | 연결 방식 | 연결지향 (3-way handshake) | 비연결지향 (handshake 없음) |
    | 신뢰성 | 있음: 순서 보장, 손실 시 재전송 | 없음: 순서·전달 보장 X |
    | 흐름/혼잡 제어 | 있음 | 없음 |
    | 속도/오버헤드 | 느리지만 안정, 헤더 크고 복잡 | 빠르지만 불안정, 헤더 작고 단순 |
    | 통신 단위 | 스트림(연속 바이트) | 메시지(데이터그램) |
    | 대표 사용처 | HTTP, 파일 전송, 메일, DB 연결 등 | DNS, 스트리밍, 게임, VoIP 등 |
- 외우기 포인트
    - **“신뢰성 필요하면 TCP, 속도·실시간이면 UDP”**
    - TCP = 전화 통화(통화 연결 후 대화), UDP = 택배 뿌리기(보내고 신경 안 씀).
